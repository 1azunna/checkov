metadata:
  name: "Manulife Policy - keyvault_004a - Ensure Azure Key Vault has audit event logging enabled (R_2.4)"
  id: keyvault_004a
  guidelines: "Ensure Azure Key Vault has audit event logging enabled (R_2.4)"
  category: logging
  severity: high
scope:
  provider: azure
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - azurerm_key_vault
      operator: within
    - cond_type: connection
      resource_types:
        - azurerm_key_vault
      connected_resource_types:
        - azurerm_monitor_diagnostic_setting
      operator: exists
    - cond_type: attribute
      resource_types:
        - azurerm_monitor_diagnostic_setting
      attribute: log[?(@.category == 'AuditEvent')]
      operator: jsonpath_exists
    - or:
      - cond_type: attribute
        resource_types:
          - azurerm_monitor_diagnostic_setting
        attribute: log[?(@.category == 'AuditEvent')].enabled
        operator: jsonpath_is_true
      - cond_type: attribute
        resource_types:
          - azurerm_monitor_diagnostic_setting
        attribute: log[?(@.category == 'AuditEvent')].enabled
        operator: jsonpath_not_exists